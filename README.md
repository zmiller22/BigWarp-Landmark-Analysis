# README
### Note, you will need to download the Java dependency files separately for this repo to work, as the Java dependencies are not included in the repo. The dependencies are located in this dropbox folder: https://www.dropbox.com/sh/opz1riwykd06u8y/AADuMthA-XbUy2d6iS6i9R4ya?dl=0. Once downloaded, put `java_files` in the same folder as AnalyzeLandmarks.m

# BigWarp-Landmark-Analysis
This repo provides tools for visualizing and quantifying transformations generated in FIJI BigWarp. First, two transformations are calculated from the points in the landmarks file. One is the Thin-Plate Spline (TPS) generated with BigWarp and the other is the best fit affine transformation (least-squares solution) between the moving and fixed landmarks. Then, the tool generates a 3d point lattice with the same dimensions as the moving image. This point lattice is then transformed to generate two transformed point lattices, one using the TPS transformatin and the other using the best fit affine transformation. Finally, the distance between each point in the TPS transformed lattice and the affine transormed lattice is calculated and used a proxy for the amount of non-linear warping present at that point in the image. 

This tool uses the following two files as its main input:
* A landmark .csv file in the format generated by the FIJI BigWarp tool that contains the points being used to generate the TPS transforma (required)
 * A "boundary points" landmark.csv file in the format generated by the FIJI BigWarp tool (optional). These landmarks are used to created a bounding box to trim the point lattice so it includes only the region of the image you are interested in, more details below.
 
 In addition, you will be asked for the x, y, and z dimensions of the moving image as well as the desired edge length for the point lattice, both of which should be provided in terms of the physical units of the image stacks. 

# Usage
 
To use this tool first make sure you have added the the java dependencies properly, then run the file `AnalyzeLandmarks.m`. 

You be prompted to select the landmarks file. Navigate to the landmark file you want to test and select it. Note that the landmark coordinates must be in terms of physical units. This is the default behavior of BigWarp, but may not be the case if the metadata of your image files are not correctly set. See this forum for more details: https://forum.image.sc/t/units-of-landmark-coordinates/36433

Once you have selected your landmarks file, you will be promped to select an optional boundary points file. The bondary points will create a bounding region such that only lattice points within that region are kept. This can be useful if the landmarks are concentrated in one area of the total image volume. For example, if you have imaged a specimen that lies in the middle of your image stack, you can use a boundary points file to cut away the portions of the point lattice that are not within the region of the specimen. Note that the boundary points should be in the space of the moving image stack. There are three options for proceeding:
* If you do not with to use a boundary points file, you can simply click `cancel`. This will return the full point lattice, which will have approximately the same dimension of the moving image volume.
* You can select a specifically made boundary point file. Such a file can be made easily in BigWarp by adding many points along the boundary of your region of interest in the moving volume and adding no cooresponding points for the fixed volume. If the boundary of the region of interest is thoroughly saturated, this will cut away the rest of the point lattice such that only the part of the lattice in the region remains.
* You can use the same file as your landmarks file. Note, however, that if the border of the area you are interested in is not thoroughly saturated with landmarks, this could trim away unexpected parts of the point lattice.

Lastly, you will be prompted to enter two values at the command line. The first is the physical (not pixel) dimensions of your entire moving volume, which should be entered in the same format as a Matlab array. For example, if your moving volume has dimensions 100x200x300 in x, y, and z, you would enter `[100,200,300]`. Lastly, you will be asked to enter an edge length for the point lattice. The edge length specifies the distances between all the points in the evenly spaced initial point lattice. For example, if you are working with microns as your units and you want your point lattice to have spacial resolution of 2 microns, you would enter `2`. Note that the smaller the edge length, the more points in the point lattice and therefore the more time it takes for the program to run. If the program is taking too long, cancel and try running again with a larger edge length.

Once all of the above information has been entered, the program will proceed with the necessary calculations and produce the plots.

# Plots
## TODO add description and detail on the produced plots

# Agknowledgments

This tool is built upon the functionality of this tool:
https://github.com/saalfeldlab/bigwarp

Many thanks to John Bogovic, who has been extremely helpful in providing all necessary details on BigWarp during the development of this tool.


